<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Screw Stalkers</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f9f9f9;
            margin: 0;
            padding: 0;
            transition: background-color 0.3s, color 0.3s;
        }
        body.dark-mode {
            background-color: #121212;
            color: #e0e0e0;
        }
        nav {
            background: #333;
            color: #fff;
            padding: 10px;
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
        }
        nav a {
            color: #fff;
            text-decoration: none;
            padding: 5px 10px;
            margin: 5px;
            background-color: #0070f3;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        main {
            padding: 20px;
            margin: 20px auto;
            max-width: 800px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transition: background-color 0.3s, color 0.3s;
        }
        main.dark-mode {
            background-color: #1e1e1e;
        }
        .hidden {
            display: none;
        }
        .scrollable {
            max-height: 400px;
            overflow-y: auto;
        }
        .profile-photo {
            width: 150px;
            height: 150px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 72px;
            color: white;
            background-color: gray;
            border-radius: 50%;
        }
        .profile-bubble {
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
            background-color: gray;
            border-radius: 50%;
            cursor: pointer;
        }
        button {
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.1s ease-in-out;
        }
        button:active {
            box-shadow: none;
            transform: translateY(2px);
        }
        .back-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 10px 20px;
            background-color: #0070f3;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .highlight {
            background-color: yellow;
        }
        .status-dot {
            width: 10px;
            height: 10px;
            display: inline-block;
            border-radius: 50%;
        }
        .active {
            background-color: green;
        }
        .inactive {
            background-color: gray;
        }
        .role-dot {
            width: 10px;
            height: 10px;
            display: inline-block;
            border-radius: 50%;
        }
        .manager-role {
            background-color: gold;
        }
        .moderator-role {
            background-color: silver;
        }
        .standard-role {
            background-color: blue;
        }
        .profile-options {
            display: flex;
            justify-content: space-between;
        }
        img {
            width: 100%;
            height: auto;
        }
        .profile-row {
            display: flex;
            align-items: center;
        }
        .profile-row img {
            margin-right: 10px;
        }
        .profile-bubble-container {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        .profile-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .profile-info {
            margin-left: 10px;
        }
        .profile-bubble-fixed {
            position: fixed;
            top: 20px;
            right: 80px;
        }
        .about {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <nav id="nav-links" class="hidden">
        <!-- Navigation links will be dynamically added based on the user role -->
    </nav>
    <nav>
        <div>Screw Stalkers</div>
        <div>
            <a href="javascript:void(0)" id="login-logout" onclick="showSection('login')">Login</a>
            <a href="javascript:void(0)" id="signup-link" onclick="showSection('signup')">Sign Up</a>
            <a href="javascript:void(0)" id="about-link" onclick="showSection('about')">About</a>
        </div>
    </nav>
    
    <main>
        <div id="navigation" class="hidden">
            <h2>Navigation</h2>
            <ul id="nav-list">
                <li><a href="javascript:void(0)" onclick="showSection('home')">Home</a></li>
                <li><a href="javascript:void(0)" onclick="showSection('community-forum')">Community Forum</a></li>
                <li><a href="javascript:void(0)" onclick="showSection('chat-room')">Chat Room</a></li>
                <li><a href="javascript:void(0)" onclick="showSection('report')">Report</a></li>
                <li><a href="javascript:void(0)" onclick="showSection('settings')">Settings</a></li>
            </ul>
        </div>

        <div id="home" class="hidden">
            <h2>Welcome to Screw Stalkers</h2>
            <p>Our platform allows users to create profiles, log in, make posts, participate in community forums, and report suspicious profiles. Join us in creating a safer online community.</p>
            <form class="search-form" onsubmit="searchProfiles(event)">
                <input type="text" id="search-query" name="search-query" placeholder="Search profiles..." required>
                <button type="submit">Search</button>
            </form>
        </div>
        <div id="community-forum" class="hidden scrollable">
            <h2>Community Forum</h2>
            <p>Join the discussion and engage with other users.</p>
            <div id="posts">
                <article class="profile-actions">
                    <div class="profile-bubble-container">
                        <img src="https://via.placeholder.com/50" class="profile-bubble" alt="Profile Photo">
                        <span class="status-dot active"></span>
                        <span class="role-dot manager-role"></span>
                    </div>
                    <div class="profile-info">
                        <h3>Example Post Title</h3>
                        <p>This is an example post in the community forum.</p>
                    </div>
                </article>
            </div>
            <form onsubmit="postToForum(event)">
                <div class="profile-bubble-container">
                    <img src="https://via.placeholder.com/50" class="profile-bubble" alt="Profile Photo">
                    <textarea placeholder="Write a new post..." required></textarea>
                    <input type="file" name="post-image" accept="image/*">
                </div>
                <button type="submit">Post</button>
            </form>
        </div>
        <div id="chat-room" class="hidden scrollable">
            <h2>Chat Room</h2>
            <div id="chat-messages" class="scrollable">
                <div class="profile-actions">
                    <div class="profile-bubble-container">
                        <img src="https://via.placeholder.com/50" class="profile-bubble" alt="Profile Photo">
                        <span class="status-dot active"></span>
                        <span class="role-dot manager-role"></span>
                    </div>
                    <div class="profile-info">
                        <strong>John Doe</strong>: Hello everyone!
                    </div>
                </div>
                <div class="profile-actions">
                    <div class="profile-bubble-container">
                        <img src="https://via.placeholder.com/50" class="profile-bubble" alt="Profile Photo">
                        <span class="status-dot inactive"></span>
                        <span class="role-dot standard-role"></span>
                    </div>
                    <div class="profile-info">
                        <strong>Jane Smith</strong>: Hi John!
                    </div>
                </div>
            </div>
            <form onsubmit="sendMessage(event)">
                <input type="text" id="chat-input" placeholder="Type a message..." required>
                <button type="submit">Send</button>
            </form>
        </div>
        <div id="report" class="hidden">
            <h2>Report a Profile</h2>
            <form onsubmit ="submitReport(event)">
                <input type="url" placeholder="Profile URL" required>
                <select onchange="toggleOtherReason(event)" required>
                    <option value="">Select a reason</option>
                    <option value="cyberbullying">Cyberbullying</option>
                    <option value="slander">Slander</option>
                    <option value="foul-language">Foul Language</option>
                    <option value="threats">Threats</option>
                    <option value="other">Other</option>
                </select>
                <textarea id="other-reason" class="hidden" placeholder="Describe the issue"></textarea>
                <button type="submit">Submit Report</button>
            </form>
        </div>
        <div id="signup" class="hidden">
            <h2>Sign Up</h2>
            <form id="signup-form" onsubmit="signup(event)">
                <input type="text" id="signup-username" placeholder="Username" required>
                <input type="email" id="signup-email" placeholder="Email" required>
                <input type="password" id="signup-password" placeholder="Password" required oninput="validatePassword(event)">
                <small>Password must be at least 8 characters long, contain one or more uppercase letters, one or more lowercase letters, one or more numbers, and may include special characters.</small>
                <button type="submit">Sign Up</button>
            </form>
            <p>By using this site, you agree to our <a href="javascript:void(0)" onclick="showSection('privacy-policy')">Privacy Policy</a> and <a href="javascript:void(0)" onclick="showSection('terms-of-service')">Terms of Service</a>.</p>
        </div>
        <div id="login">
            <h2>Login</h2>
            <form id="login-form" onsubmit="login(event)">
                <input type="text" id="username" placeholder="Username" required>
                <input type="password" id="password" placeholder="Password" required>
                <button type="submit">Login</button>
            </form>
            <p>By using this site, you agree to our <a href="javascript:void(0)" onclick="showSection('privacy-policy')">Privacy Policy</a> and <a href="javascript:void(0)" onclick="showSection('terms-of-service')">Terms of Service</a>.</p>
            <p>Active users: <span id="active-users-count">0</span></p>
        </div>
        <div id="edit-profile" class="hidden">
            <h2>Edit Profile</h2>
            <form onsubmit="saveProfile(event)">
                <input type="text" id="edit-username" placeholder="Username" required>
                <textarea id="edit-bio" placeholder="Bio"></textarea>
                <input type="file" id="edit-photo" name="profile-photo" accept="image/*">
                <button type="submit">Save</button>
            </form>
        </div>
        <div id="manager-profile" class="hidden">
            <h2>Manager Profile: Jordan Black</h2>
            <p>Welcome, Jordan Black. Manage the community forum, make posts, and access the chat room.</p>
            <ul>
                <li><a href="javascript:void(0)" onclick="showSection('community-forum')">View Community Forum</a></li>
                <li><a href="javascript:void(0)" onclick="showSection('community-forum')">Post to Community Forum</a></li>
                <li><a href="javascript:void(0)" onclick="showSection('chat-room')">Chat Room</a></li>
                <li><a href="javascript:void(0)" onclick="showSection('edit-profile')">Edit Profile</a></li>
                <li><a href="javascript:void(0)" onclick="showSection('reports-hub')">Reports Hub</a></li>
                <li><a href="javascript:void(0)" onclick="showSection('reported-moderators')">Reported Moderators</a></li>
                <li><a href="javascript:void(0)" onclick="showSection('statistics')">Statistics</a></li>
                <li><a href="javascript:void(0)" onclick="showSection('settings')">Settings</a></li>
                <li><a href="javascript:void(0)" onclick="showSection('blocked-emails')">Blocked Emails</a></li>
            </ul>
        </div>
        <div id="reports-hub" class="hidden">
            <h2>Reports Hub</h2>
            <div id="reported-users-list">
                <div class="profile-row" onclick="viewReportedUser('reported-user')">
                    <img src="https://via.placeholder.com/50" class="profile-bubble" alt="Profile Photo">
                    <span>Reported User</span>
                    <button onclick="toggleBan(event, 'reported-user')">Ban</button>
                    <select id="ban-duration-reported-user" class="hidden">
                        <option value="1">1 day</option>
                        <option value="3">3 days</option>
                        <option value="7">7 days</option>
                        <option value="indefinitely">Indefinitely</option>
                    </select>
                </div>
                <div id="reported-user-details" class="profile-details hidden">
                    <p class="highlight">Reported comment: Example reported comment.</p>
                    <div class="scrollable">
                        <p>Message 1</p>
                        <p>Message 2</p>
                        <p>Message 3</p>
                        <p>Message 4</p>
                        <p>Message 5</p>
                        <p>Message 6</p>
                        <p>Message 7</p>
                        <p>Message 8</p>
                        <p>Message 9</p>
                        <p>Message 10</p>
                    </div>
                </div>
            </div>
        </div>
        <div id="reported-moderators" class="hidden">
            <h2>Reported Moderators</h2>
            <div id="reported-moderators-list">
                <div class="profile-row" onclick="viewReportedModerator('reported-moderator')">
                    <img src="https://via.placeholder.com/50" class="profile-bubble" alt="Profile Photo">
                    <span>Reported Moderator</span>
                    <button onclick="toggleBan(event, 'reported-moderator')">Ban</button>
                    <select id="ban-duration-reported-moderator" class="hidden">
                        <option value="1">1 day</option>
                        <option value="3">3 days</option>
                        <option value="7">7 days</option>
                        <option value="indefinitely">Indefinitely</option>
                    </select>
                </div>
                <div id="reported-moderator-details" class="profile-details hidden">
                    <p class="highlight">Reported comment: Example reported comment.</p>
                    <div class="scrollable">
                        <p>Message 1</p>
                        <p>Message 2</p>
                        <p>Message 3</p>
                        <p>Message 4</p>
                        <p>Message 5</p>
                        <p>Message 6</p>
                        <p>Message 7</p>
                        <p>Message 8</p>
                        <p>Message 9</p>
                        <p>Message 10</p>
                    </div>
                </div>
            </div>
        </div>
        <div id="statistics" class="hidden">
            <h2>Statistics</h2>
            <p>Total Profiles: <span id="total-profiles">0</span></p>
            <p>Number of Moderators: <span id="total-moderators">0</span></p>
            <p>Site Running Time: <span id="site-running-time"></span></p>
        </div>
        <div id="blocked-emails" class="hidden">
            <h2>Blocked Emails</h2>
            <ul id="blocked-email-list">
                <!-- Blocked emails will be listed here -->
            </ul>
        </div>
        <div id="settings" class="hidden">
            <h2>Settings</h2>
            <form>
                <label for="dark-mode">Dark Mode:</label>
                <input type="checkbox" id="dark-mode" name="dark-mode" onclick="toggleDarkMode()">
                <button type="button" onclick="deleteProfile()">Delete Profile</button>
            </form>
        </div>
        <div id="privacy-policy" class="hidden">
            <h2>Privacy Policy</h2>
            <p>Your privacy is important to us. We guarantee that no data will be shared with third parties. We follow standard legal practices to ensure your data is protected.</p>
        </div>
        <div id="terms-of-service" class="hidden">
            <h2>Terms of Service</h2>
            <p>By using this site, you agree to the following terms:</p>
            <ul>
                <li>No tolerance for cyberbullying, threats, sexual content, or other potentially harmful content.</li>
                <li>Immediate and permanent ban for violations.</li>
                <li>Standard legal practices apply.</li>
            </ul>
        </div>
        <div id="about" class="hidden">
            <h2>About</h2>
            <p>The first dot by a profile bubble is active status. Green is active and grey is not active. The dot on the right is role status. Silver is a moderator and gold is a manager which is a site owner.</p>
            <p>Moderators can ban people, delete their profiles, block emails from sign up, and monitor site chats and reports. A site manager can ban and delete moderators and assume their responsibilities as well.</p>
            <p>Wondering how to become a moderator? 6 hours in on-site time with no reports against you will qualify you for sign up. A button will appear, and all you have to do is push it for a role status change.</p>
            <p>Remember, you can be banned permanently for inappropriate behavior both as a member and a moderator.</p>
        </div>
    </main>

    <div id="profile-bubble" class="profile-bubble hidden profile-bubble-fixed" onclick="showSection('edit-profile')">A</div>
    <button id="back-button" class="back-button hidden" onclick="goBack()">Back</button>

    <script>
        const users = {
            'JordanBlack': {
                username: 'JordanBlack',
                role: 'manager',
                password: 'Bruh(123)',
                email: '',
                verified: true,
                bio: '',
                photo: '',
                active: true,
                timeSpent: 0,
                reports: [],
                forumPosts: [],
                chatMessages: [],
                lastUsernameChange: null
            },
            'Jdb': {
                username: 'Jdb',
                role: 'moderator',
                password: 'Bruh(123)',
                email: '',
                verified: true,
                bio: '',
                photo: '',
                active: true,
                timeSpent: 0,
                reports: [],
                forumPosts: [],
                chatMessages: [],
                lastUsernameChange: null
            },
            'reported-moderator': {
                username: 'reported-moderator',
                role: 'moderator',
                password: 'Bruh(123)',
                email: '',
                verified: true,
                bio: '',
                photo: '',
                active: true,
                banned: false,
                timeSpent: 0,
                reports: [],
                forumPosts: [],
                chatMessages: [
                    'Message 1', 'Message 2', 'Message 3', 'Message 4', 'Message 5',
                    'Message 6', 'Message 7', 'Message 8', 'Message 9', 'Message 10'
                ],
                lastUsernameChange: null
            },
            'reported-user': {
                username: 'reported-user',
                role: 'user',
                password: 'Bruh(123)',
                email: '',
                verified: true,
                bio: '',
                photo: '',
                active: true,
                banned: false,
                timeSpent: 0,
                reports: [],
                forumPosts: [],
                chatMessages: [
                    'Message 1', 'Message 2', 'Message 3', 'Message 4', 'Message 5',
                    'Message 6', 'Message 7', 'Message 8', 'Message 9', 'Message 10'
                ],
                lastUsernameChange: null
            }
        };
        const blockedEmails = [];
        let activeUsers = 0;
        const startDate = new Date();
        let currentUser = null;
        let siteHistory = [];

        function login(event) {
            event.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            if (users[username] && users[username].password === password) {
                if (users[username].banned) {
                    alert('You have been banned from this site.');
                    return;
                }
                alert('Login successful. Welcome, ' + username + '!');
                currentUser = users[username];
                activeUsers++;
                document.getElementById('active-users-count').innerText = activeUsers;
                document.getElementById('login').classList.add('hidden');
                document.getElementById('signup-link').classList.add('hidden');
                document.getElementById('nav-links').classList.remove('hidden');
                document.getElementById('login-logout').innerText = 'Logout';
                document.getElementById('login-logout').onclick = logout;
                document.getElementById('profile-bubble').classList.remove('hidden');
                if (currentUser.photo) {
                    document.getElementById('profile-bubble').style.backgroundImage = `url(${currentUser.photo})`;
                    document.getElementById('profile-bubble').innerText = '';
                } else {
                    document.getElementById('profile-bubble').innerText = username[0].toUpperCase();
                }
                document.getElementById('back-button').classList.remove('hidden');

                if (users[username].role === 'manager') {
                    document.getElementById('manager-profile').classList.remove('hidden');
                    addNavigationLinks(['home', 'community-forum', 'chat-room', 'report', 'settings', 'edit-profile', 'reports-hub', 'reported-moderators', 'statistics', 'blocked-emails']);
                } else if (users[username].role === 'moderator') {
                    document.getElementById('moderator-profile').classList.remove('hidden');
                    addNavigationLinks(['home', 'community-forum', 'chat-room', 'report', 'settings', 'edit-profile', 'reports-hub']);
                } else {
                    addNavigationLinks(['home', 'community-forum', 'chat-room', 'report', 'settings']);
                }
                showSection('navigation');
            } else {
                alert('Incorrect username or password. Please try again.');
            }
        }

        function logout() {
            alert('Logout successful.');
            currentUser = null;
            activeUsers--;
            document.getElementById('active-users-count').innerText = activeUsers;
            document.getElementById('login-logout').innerText = 'Login';
            document.getElementById('login-logout').onclick = function() { showSection('login'); };
            document.getElementById('signup-link').classList.remove('hidden');
            document.getElementById('profile-bubble').classList.add('hidden');
            document.getElementById('nav-links').classList.add('hidden');
            document.getElementById('back-button').classList.add('hidden');
            showSection('navigation');
            siteHistory = [];
        }

        function signup(event) {
            event.preventDefault();
            const username = document.getElementById('signup-username').value;
            const email = document.getElementById('signup-email').value;
            const password = document.getElementById('signup-password').value;

            if (blockedEmails.includes(email)) {
                alert('This email is blocked and cannot be used to create a new profile.');
                return;
            }

            if (validatePassword({ target: { value: password } })) {
                users[username] = {
                    username: username,
                    role: 'user',
                    password: password,
                    email: email,
                    verified: false,
                    bio: '',
                    photo: '',
                    active: false,
                    timeSpent: 0,
                    reports: [],
                    forumPosts: [],
                    chatMessages: [],
                    lastUsernameChange: null
                };
                alert('Sign up successful. Please check your email to verify your account.');
                document.getElementById('signup').classList.add('hidden');
                showSection('login');
                sendVerificationEmail(username, email);
            } else {
                alert('Password does not meet the requirements.');
            }
        }

        function sendVerificationEmail(username, email) {
            alert(`Verification email sent to ${email}. Click the link in the email to verify your account.`);
            setTimeout(() => verifyAccount(username), 3000); // Simulate email verification link click
        }

        function verifyAccount(username) {
            users[username].verified = true;
            alert('Account verified. You are now logged in.');
            loginUser(username);
        }

        function loginUser(username) {
            currentUser = users[username];
            document.getElementById('profile-bubble').classList.remove('hidden');
            if (currentUser.photo) {
                document.getElementById('profile-bubble').style.backgroundImage = `url(${currentUser.photo})`;
                document.getElementById('profile-bubble').innerText = '';
            } else {
                document.getElementById('profile-bubble').innerText = username[0].toUpperCase();
            }
            showSection('navigation');
        }

        function validatePassword(event) {
            const password = event.target.value;
            const regex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[A-Za-z\d@$!%*?&]{8,}$/;
            return regex.test(password);
        }

        function toggleOtherReason(event) {
            const otherReason = document.getElementById('other-reason');
            if (event.target.value === 'other') {
                otherReason.classList.remove('hidden');
            } else {
                otherReason.classList.add('hidden');
            }
        }

        function showSection(sectionId) {
            if (currentUser) {
                siteHistory.push(sectionId);
            }
            document.querySelectorAll('main > div').forEach(section => {
                section.classList.add('hidden');
            });
            document.getElementById(sectionId).classList.remove('hidden');
            if (currentUser) {
                displayUserStatus();
            }
        }

        function toggleDarkMode() {        document.body.classList.toggle('dark-mode');
        document.querySelectorAll('main').forEach(main => main.classList.toggle('dark-mode'));
    }

    function deleteProfile() {
        if (currentUser.role === 'manager') {
            const password = prompt('Enter your password to delete your profile:');
            if (password === '1047') {
                blockedEmails.push(currentUser.email);
                delete users[currentUser.username];
                alert('Profile deleted.');
                logout();
            } else {
                alert('Incorrect password. Profile deletion canceled.');
            }
        } else if (currentUser) {
            blockedEmails.push(currentUser.email);
            delete users[currentUser.username];
            alert('Profile deleted.');
            logout();
        } else {
            alert('No profile to delete.');
        }
    }

    function sendMessage(event) {
        event.preventDefault();
        if (!currentUser.verified) {
            alert('Your account is not verified. Please verify your account to send messages.');
            return;
        }
        const chatInput = document.getElementById('chat-input').value;
        const chatMessages = document.getElementById('chat-messages');
        const newMessage = document.createElement('div');
        newMessage.classList.add('profile-actions');
        newMessage.innerHTML = `
            <div class="profile-bubble-container">
                <img src="${currentUser.photo || 'https://via.placeholder.com/50'}" class="profile-bubble" alt="Profile Photo">
                <span class="status-dot ${currentUser.active ? 'active' : 'inactive'}"></span>
                <span class="role-dot ${currentUser.role === 'manager' ? 'manager-role' : currentUser.role === 'moderator' ? 'moderator-role' : 'standard-role'}"></span>
            </div>
            <div class="profile-info">
                <strong>${currentUser.username}</strong>: ${chatInput}
            </div>`;
        newMessage.dataset.timestamp = new Date();
        chatMessages.appendChild(newMessage);
        document.getElementById('chat-input').value = '';

        currentUser.chatMessages.push({ message: chatInput, timestamp: new Date() }); // Save chat message to user's profile

        const fourHoursAgo = new Date(Date.now() - 4 * 60 * 60 * 1000); // Remove messages older than 4 hours
        while (chatMessages.firstChild && new Date(chatMessages.firstChild.dataset.timestamp) < fourHoursAgo) {
            chatMessages.removeChild(chatMessages.firstChild);
        }
    }

    function postToForum(event) {
        event.preventDefault();
        if (!currentUser.verified) {
            alert('Your account is not verified. Please verify your account to post.');
            return;
        }
        const postText = event.target.querySelector('textarea').value;
        const postImage = event.target.querySelector('input[type="file"]').files[0];
        const post = document.createElement('article');
        post.classList.add('profile-actions');
        post.innerHTML = `
            <div class="profile-bubble-container">
                <img src="${currentUser.photo || 'https://via.placeholder.com/50'}" class="profile-bubble" alt="Profile Photo">
                <span class="status-dot ${currentUser.active ? 'active' : 'inactive'}"></span>
                <span class="role-dot ${currentUser.role === 'manager' ? 'manager-role' : currentUser.role === 'moderator' ? 'moderator-role' : 'standard-role'}"></span>
            </div>
            <div class="profile-info">
                <p>${postText}</p>`;
        if (postImage) {
            const img = document.createElement('img');
            img.src = URL.createObjectURL(postImage);
            img.alt = 'Post Image';
            post.appendChild(img);
        }
        post.innerHTML += '</div>';
        document.getElementById('posts').appendChild(post);

        currentUser.forumPosts.push({ postText, postImage, timestamp: new Date() }); // Save forum post to user's profile

        event.target.querySelector('textarea').value = ''; // Clear the form
        event.target.querySelector('input[type="file"]').value = '';
    }

    function saveProfile(event) {
        event.preventDefault();
        const username = document.getElementById('edit-username').value;
        const bio = document.getElementById('edit-bio').value;
        const photo = document.getElementById('edit-photo').files[0];

        const currentDate = new Date();
        const sixMonths = 6 * 30 * 24 * 60 * 60 * 1000;

        if (currentUser.lastUsernameChange && currentDate - new Date(currentUser.lastUsernameChange) < sixMonths) {
            alert('You can only change your username every six months.');
            return;
        }

        if (photo) {
            const reader = new FileReader();
            reader.onload = function(e) {
                currentUser.photo = e.target.result;
                document.getElementById('profile-bubble').style.backgroundImage = `url(${e.target.result})`;
                document.getElementById('profile-bubble').innerText = '';
            };
            reader.readAsDataURL(photo);
        }

        currentUser.username = username;
        currentUser.bio = bio;
        currentUser.lastUsernameChange = new Date();

        alert('Profile saved.');
        document.getElementById('profile-bubble').innerText = username[0].toUpperCase();
        showSection('navigation');
    }

    function searchProfiles(event) {
        event.preventDefault();
        // Implement profile search logic here
        const query = document.getElementById('search-query').value.toLowerCase();
        const results = Object.values(users).filter(user => user.username.toLowerCase().includes(query));
        const limitedResults = results.slice(0, 25); // Limit to 25 profiles

        const resultList = document.createElement('ul');
        limitedResults.forEach(user => {
            const listItem = document.createElement('li');
            listItem.classList.add('profile-row');
            listItem.innerHTML = `
                <img src="${user.photo || 'https://via.placeholder.com/50'}" class="profile-bubble" alt="Profile Photo">
                <span>${user.username}</span>
                <button onclick="viewProfile('${user.username}')">View Profile</button>`;
            resultList.appendChild(listItem);
        });

        const searchResults = document.createElement('div');
        searchResults.id = 'search-results';
        searchResults.appendChild(resultList);

        const homeSection = document.getElementById('home');
        homeSection.appendChild(searchResults);
    }

    function reportContent(event, type) {
        // Implement content reporting logic here
        alert(`Reported ${type}.`);
    }

    function goBack() {
        siteHistory.pop(); // Remove current page
        const lastSectionId = siteHistory.pop(); // Get previous page
        if (lastSectionId) {
            showSection(lastSectionId);
        } else {
            showSection('navigation');
        }
    }

    function updateStatistics() {
        document.getElementById('total-profiles').innerText = Object.keys(users).length;
        document.getElementById('total-moderators').innerText = Object.values(users).filter(user => user.role === 'moderator').length;
        document.getElementById('site-running-time').innerText = `${Math.floor((new Date() - startDate) / (1000 * 60 * 60 * 24))} days`;
    }

    function toggleBan(event, username) {
        event.stopPropagation();
        const user = users[username];
        if (currentUser.role === 'moderator' && user.role === 'moderator') {
            alert('Moderators cannot ban other moderators.');
            return;
        }
        const banDuration = document.getElementById(`ban-duration-${username}`);
        if (banDuration.classList.contains('hidden')) {
            banDuration.classList.remove('hidden');
            return;
        }
        const duration = banDuration.value;
        user.banned = true;
        if (duration !== 'indefinitely') {
            setTimeout(() => {
                user.banned = false;
                alert(`${username} has been unbanned.`);
            }, duration * 24 * 60 * 60 * 1000); // Convert days to milliseconds
            alert(`${username} has been banned for ${duration} days.`);
        } else {
            alert(`${username} has been banned indefinitely.`);
            const button = document.querySelector(`button[onclick="toggleBan(event, '${username}')"]`);
            button.textContent = 'Unban';
        }
    }

    function viewReportedModerator(username) {
        if (currentUser.role !== 'manager') {
            alert('Only managers can view reported moderators.');
            return;
        }
        const details = document.getElementById('reported-moderator-details');
        details.classList.remove('hidden');
    }

    function viewReportedUser(username) {
        const details = document.getElementById('reported-user-details');
        details.classList.remove('hidden');
    }

    function addNavigationLinks(links) {
        const navLinks = document.getElementById('nav-links');
        navLinks.innerHTML = '';
        links.forEach(link => {
            const a = document.createElement('a');
            a.href = `javascript:void(0)`;
            a.textContent = link.replace('-', ' ');
            a.onclick = () => showSection(link);
            navLinks.appendChild(a);
        });
    }

    function displayUserStatus() {
        const statusDot = document.createElement('span');
        statusDot.classList.add('status-dot', currentUser.active ? 'active' : 'inactive');

        const roleDot = document.createElement('span');
            roleDot.classList.add('role-dot');
            if (currentUser.role === 'manager') {
                roleDot.classList.add('manager-role');
            } else if (currentUser.role === 'moderator') {
                roleDot.classList.add('moderator-role');
            } else {
                roleDot.classList.add('standard-role');
            }

            const profileBubble = document.getElementById('profile-bubble');
            profileBubble.innerHTML = '';
            profileBubble.appendChild(statusDot);
            profileBubble.appendChild(roleDot);
            if (currentUser.photo) {
                profileBubble.style.backgroundImage = `url(${currentUser.photo})`;
            } else {
                profileBubble.appendChild(document.createTextNode(currentUser.username[0].toUpperCase()));
            }
        }

        function viewProfile(username) {
            const user = users[username];
            alert(`Viewing profile of ${user.username}`);
            // Implement profile view logic
        }

        setInterval(updateStatistics, 60000); // Call this function to update statistics periodically
    </script>
</body>
</html>
